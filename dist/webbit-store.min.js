!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(e=e||self,r(e.webbitStore={}))}(this,function(e){"use strict";function r(e,r,t,n){var u=-1,o=e?e.length:0;for(n&&o&&(t=e[++u]);++u<o;)t=r(t,e[u],u,e);return t}function t(e){return e.split("")}function n(e){return e.match(j)||[]}function u(e){return M.test(e)}function o(e){return Y.test(e)}function i(e){return u(e)?f(e):t(e)}function f(e){return e.match(K)||[]}function c(e){return e.match(G)||[]}function a(e,r,t){var n=-1,u=e.length;r<0&&(r=-r>u?0:u+r),(t=t>u?u:t)<0&&(t+=u),u=r>t?0:t-r>>>0,r>>>=0;for(var o=Array(u);++n<u;)o[n]=e[n+r];return o}function s(e){if("string"==typeof e)return e;if(l(e))return X?X.call(e):"";var r=e+"";return"0"==r&&1/e==-m?"-0":r}function _(e,r,t){var n=e.length;return t=void 0===t?n:t,!r&&t>=n?e:a(e,r,t)}function d(e){return!!e&&"object"==typeof e}function l(e){return"symbol"==typeof e||d(e)&&q.call(e)==O}function v(e){return null==e?"":s(e)}function p(e){return re(v(e).toLowerCase())}function y(e){return(e=v(e))&&e.replace(P,W).replace(L,"")}function b(e,r,t){return e=v(e),r=t?void 0:r,void 0===r?o(e)?c(e):n(e):e.match(r)||[]}function g(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function h(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function x(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?h(Object(t),!0).forEach(function(r){g(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var m=1/0,O="[object Symbol]",j=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,P=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,E="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",S="["+E+"]",U="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",w="[a-z\\xdf-\\xf6\\xf8-\\xff]",A="[^\\ud800-\\udfff"+E+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",N="\\ud83c[\\udffb-\\udfff]",k="(?:\\ud83c[\\udde6-\\uddff]){2}",z="[\\ud800-\\udbff][\\udc00-\\udfff]",T="[A-Z\\xc0-\\xd6\\xd8-\\xde]",C="(?:"+w+"|"+A+")",I="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",V="[\\ufe0e\\ufe0f]?"+I+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",k,z].join("|")+")[\\ufe0e\\ufe0f]?"+I+")*"),D="(?:"+["[\\u2700-\\u27bf]",k,z].join("|")+")"+V,R="(?:"+["[^\\ud800-\\udfff]"+U+"?",U,k,z,"[\\ud800-\\udfff]"].join("|")+")",Z=RegExp("['’]","g"),L=RegExp(U,"g"),K=RegExp(N+"(?="+N+")|"+R+V,"g"),G=RegExp([T+"?"+w+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[S,T,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[S,T+C,"$"].join("|")+")",T+"?"+C+"+(?:['’](?:d|ll|m|re|s|t|ve))?",T+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d+",D].join("|"),"g"),M=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Y=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,H={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"},J="object"==typeof global&&global&&global.Object===Object&&global,$="object"==typeof self&&self&&self.Object===Object&&self,F=J||$||Function("return this")(),W=function(e){return function(r){return null==e?void 0:e[r]}}(H),q=Object.prototype.toString,B=F.Symbol,Q=B?B.prototype:void 0,X=Q?Q.toString:void 0,ee=function(e){return function(t){return r(b(y(t).replace(Z,"")),e,"")}}(function(e,r,t){return r=r.toLowerCase(),e+(t?p(r):r)}),re=function(e){return function(r){var t=u(r=v(r))?i(r):void 0,n=t?t[0]:r.charAt(0),o=t?_(t,1).join(""):r.slice(1);return n[e]()+o}}("toUpperCase"),te=e=>e.split("/").map(e=>ee(e)).join("/"),ne={},ue={},oe=null,ie=[],fe=[],ce=e=>{var{typeName:typeName}=e;if(ae(typeName))return;"SourceProvider"===Object.getPrototypeOf(e).name&&(ne[typeName]=e)},ae=e=>e in ne,se=(e,r,t)=>{t=t||{};"string"!=typeof r&&(r=e);if(!ae(e)||ye(r))return null;var n=ne[e];ue[r]=new n(r,x({},n.settingsDefaults));ie.forEach(e=>{e(r)});return ue[r]},_e=e=>{if("function"!=typeof e)return;ie.push(e)},de=e=>{if(!ye(e))return;var r=ue[e];r._disconnect();delete ue[e]},le=e=>ue[e],ve=()=>Object.keys(ne),pe=()=>Object.keys(ue),ye=e=>e in ue,be=e=>{oe=e;fe.forEach(e=>{e(oe)})},ge=()=>oe,he=e=>{if("function"!=typeof e)return;fe.push(e)};class xe{}var me={},Oe={},je={},Pe={},Ee={},Se=0,Ue=()=>({__normalizedKey__:void 0,__fromProvider__:!1,__key__:void 0,__value__:void 0,__sources__:{}}),we=()=>({getterValues:{},setters:{},sources:{}}),Ae=(e,r)=>{void 0===je[e]&&(je[e]={});void 0===je[e][r]&&(je[e][r]=new xe);return je[e][r]},Ne=(e,r,t)=>{var n=Ae(e,r);Object.getOwnPropertyNames(n).forEach(e=>{if(e in t.__sources__)return;delete n[e]});for(var u in t.__sources__){(function(r){var u=te(r);if(u in n)return"continue";var o=t.__sources__[r];Object.defineProperty(n,u,{configurable:!0,set(r){var t=Oe[e];if(void 0!==t){var n=t.setters[o.__normalizedKey__];void 0!==n&&n(r)}},get(){if(void 0!==Oe[e])return Oe[e].getterValues[o.__normalizedKey__]}})})(u)}},ke=(e,r)=>{var t=te(r).split("/");e in Pe&&t.forEach((n,u)=>{var o=t.slice(0,u+1).join("/");for(var i in Pe[e][o]||{})(0,Pe[e][o][i])(Re(e,o),o,r)});if(e in Ee)for(var n in Ee[e])(0,Ee[e][n])(Re(e,r),r)},ze=(e,r)=>{if(e in Pe)for(var t in Pe[e])for(var n in Pe[e][t])(0,Pe[e][t][n])(void 0,t,t);if(e in Ee)for(var u in Ee[e]){var o=Ee[e][u];for(var i of r)o(void 0,i)}},Te=e=>e instanceof Object&&"Source"===e.constructor.name,Ce=(e,r,t)=>{if(0===t.length)return!1;var n=t[0];var u=r[n];if(void 0===u)return!1;t.length>1&&Ce(e,u.__sources__,t.slice(1));0!==Object.keys(u.__sources__).length||u.__fromProvider__||delete r[n];if(void 0===r[n])return delete Oe[e].sources[u.__key__],delete Oe[e].getterValues[u.__key__],delete Oe[e].setters[u.__key__],!0;var o=Oe[e];Ne(e,u.__key__,u);0===Object.keys(u.__sources__).length&&(o.getterValues[u.__key__]=u.__value__);return!0},Ie=e=>me[e],Ve=(e,r)=>{var t=Ie(e);if(void 0===t)return null;if("string"!=typeof r)return t;var n=te(r).split("/");var u=t.__sources__;for(var o in n){var i=n[o];if(n.length-1===parseInt(o))return i in u?u[i]:null;if(!(i in u))return null;u=u[i].__sources__}return null},De=e=>{if(e in Oe)return Oe[e].sources;return},Re=(e,r)=>{var t=De(e);if(t)return t[te(r)];return},Ze=(e,r,t,n)=>{if("function"!=typeof t)throw new Error("Callback is not a function");r=te(r);void 0===Pe[e]&&(Pe[e]={});void 0===Pe[e][r]&&(Pe[e][r]={});var u=Se;Se++;Pe[e][r][u]=t;if(n){var o=Re(e,r);void 0!==o&&t(o,r,r)}var i=()=>{delete Pe[e][r][u]};return i},Le=(e,r,t)=>{if("function"!=typeof r)throw new Error("Callback is not a function");void 0===Ee[e]&&(Ee[e]={});var n=Se;Se++;Ee[e][n]=r;if(t){var u=De(e);Object.getOwnPropertyNames(u||{}).forEach(e=>{var t=u[e];r(t,e)})}var o=()=>{delete Ee[e][n]};return o},Ke=e=>{var r=e in me;if(!r)return;var t=Object.getOwnPropertyNames(De(e)||{});for(var n in Oe[e].getterValues)!function(r){var t=Oe[e].getterValues[r];Te(t)&&Object.getOwnPropertyNames(t).forEach(e=>{delete t[e]})}(n);me[e]=Ue();Oe[e]=we();ze(e,t)},Ge=(e,r)=>{if(void 0===me[e])return;var t=me[e];for(var n of r){var u=te(n).split("/"),o=t.__sources__;for(var i in u){var f=u[i];if(!(f in o))break;u.length-1===parseInt(i)&&(o[f].__fromProvider__=!1,o[f].__value__=void 0),o=o[f].__sources__}Ce(e,t.__sources__,u)}},Me=(e,r)=>{void 0===me[e]&&(me[e]=Ue(),Oe[e]=we());var t=me[e];for(var n in r)!function(n){var u=r[n],o=n.split("/"),i=te(n),f=i.split("/"),c=t.__sources__,a={};f.forEach((r,t)=>{var n=r in c;var i=o.slice(0,t+1).join("/");var s=Oe[e];var _=f.slice(0,t+1).join("/");n||(c[r]={__fromProvider__:!1,__normalizedKey__:_,__key__:i,__value__:void 0,__sources__:{}},s.getterValues[_]=Ae(e,i),s.setters[_]=(()=>{}),Object.defineProperty(s.sources,_,{configurable:!0,set(r){var t=Oe[e];if(void 0!==t){var n=t.setters[_];void 0!==n&&n(r)}},get(){if(void 0!==Oe[e])return Oe[e].getterValues[_]}}));if(f.length-1===t){c[r].__fromProvider__=!0,c[r].__value__=u,0===Object.keys(c[r].__sources__).length&&(s.getterValues[_]=u);var d=le(e);s.setters[_]=(e=>{d.userUpdate(i,e)})}0!==t&&(Te(s.getterValues[a.__normalizedKey__])||(s.getterValues[a.__normalizedKey__]=Ae(e,a.__normalizedKey__)),Ne(e,a.__normalizedKey__,a));a=c[r];c=c[r].__sources__}),ke(e,i)}(n)};class Ye{static get typeName(){return null}static get settingsDefaults(){return{}}get settings(){return{}}constructor(e){if(new.target===Ye)throw new TypeError("Cannot construct SourceProvider instances directly");if("string"!=typeof e)throw new TypeError("The providerName needs to be passed into super() from your provider's constructor.");this._providerName=e,this._sourceUpdates={},this._interval=setInterval(this._sendUpdates.bind(this),100)}updateSource(e,r){void 0===this._sourceUpdates[e]?this._sourceUpdates[e]={first:{type:"change",value:r}}:this._sourceUpdates[e].last={type:"change",value:r}}removeSource(e){void 0===this._sourceUpdates[e]?this._sourceUpdates[e]={first:{type:"removal"}}:this._sourceUpdates[e].last={type:"removal"}}subscribe(e,r,t){return Ze(this._providerName,e,r,t)}subscribeAll(e,r){return Le(this._providerName,e,r)}getSource(e){return Re(this._providerName,e)}getRawSource(e){return Ve(this._providerName,e)}getSources(){return De(this._providerName)}clearSources(e){this._sendUpdates(()=>{Ke(this._providerName);"function"==typeof e&&e()})}userUpdate(e,r){}getType(e){return"string"==typeof e?"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":e instanceof Array?"Array":null===e?"null":null}_disconnect(){clearTimeout(this._interval)}_sendUpdates(e){if(0===Object.keys(this._sourceUpdates).length)return void("function"==typeof e&&e());var r={},t={};for(var n in this._sourceUpdates){var u=this._sourceUpdates[n];r[n]=u.first,"last"in u&&(t[n]=u.last)}this._sendChanges(r),this._sendRemovals(r),Object.keys(t).length>0?setTimeout(()=>{this._sendChanges(t);this._sendRemovals(t);this._sourceUpdates={};"function"==typeof e&&e()}):(this._sourceUpdates={},"function"==typeof e&&e())}_sendChanges(e){var r={};for(var t in e)"change"===e[t].type&&(r[t]=e[t].value);Object.keys(r).length>0&&Me(this._providerName,r)}_sendRemovals(e){var r=[];for(var t in e)"removal"===e[t].type&&r.push(t);r.length>0&&Ge(this._providerName,r)}}var He=Ye;e.SourceProvider=He,e.addSourceProvider=se,e.addSourceProviderType=ce,e.defaultSourceProviderSet=he,e.getDefaultSourceProvider=ge,e.getSource=Re,e.getSourceProvider=le,e.getSourceProviderNames=pe,e.getSourceProviderTypeNames=ve,e.getSources=De,e.hasSourceProvider=ye,e.hasSourceProviderType=ae,e.removeSourceProvider=de,e.setDefaultSourceProvider=be,e.sourceProviderAdded=_e,Object.defineProperty(e,"__esModule",{value:!0})});
