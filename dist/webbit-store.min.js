!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(e=e||self,r(e.WebbitStore={}))}(this,function(e){"use strict";function r(e,r,t,n){var u=-1,o=e?e.length:0;for(n&&o&&(t=e[++u]);++u<o;)t=r(t,e[u],u,e);return t}function t(e){return e.split("")}function n(e){return e.match(P)||[]}function u(e){return Y.test(e)}function o(e){return F.test(e)}function i(e){return u(e)?f(e):t(e)}function f(e){return e.match(K)||[]}function c(e){return e.match(M)||[]}function s(e,r,t){var n=-1,u=e.length;r<0&&(r=-r>u?0:u+r),(t=t>u?u:t)<0&&(t+=u),u=r>t?0:t-r>>>0,r>>>=0;for(var o=Array(u);++n<u;)o[n]=e[n+r];return o}function a(e){if("string"==typeof e)return e;if(l(e))return ee?ee.call(e):"";var r=e+"";return"0"==r&&1/e==-O?"-0":r}function _(e,r,t){var n=e.length;return t=void 0===t?n:t,!r&&t>=n?e:s(e,r,t)}function d(e){return!!e&&"object"==typeof e}function l(e){return"symbol"==typeof e||d(e)&&B.call(e)==j}function v(e){return null==e?"":a(e)}function p(e){return te(v(e).toLowerCase())}function b(e){return(e=v(e))&&e.replace(S,q).replace(G,"")}function x(e,r,t){return e=v(e),r=t?void 0:r,void 0===r?o(e)?c(e):n(e):e.match(r)||[]}function g(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?y(Object(t),!0).forEach(function(r){g(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function m(e){throw new Error('"'+e+'" is read-only')}var O=1/0,j="[object Symbol]",P=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,S=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,E="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",k="["+E+"]",A="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",U="[a-z\\xdf-\\xf6\\xf8-\\xff]",w="[^\\ud800-\\udfff"+E+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",N="\\ud83c[\\udffb-\\udfff]",R="(?:\\ud83c[\\udde6-\\uddff]){2}",z="[\\ud800-\\udbff][\\udc00-\\udfff]",I="[A-Z\\xc0-\\xd6\\xd8-\\xde]",V="(?:"+U+"|"+w+")",D="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",T="[\\ufe0e\\ufe0f]?"+D+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",R,z].join("|")+")[\\ufe0e\\ufe0f]?"+D+")*"),Z="(?:"+["[\\u2700-\\u27bf]",R,z].join("|")+")"+T,C="(?:"+["[^\\ud800-\\udfff]"+A+"?",A,R,z,"[\\ud800-\\udfff]"].join("|")+")",L=RegExp("['’]","g"),G=RegExp(A,"g"),K=RegExp(N+"(?="+N+")|"+C+T,"g"),M=RegExp([I+"?"+U+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[k,I,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[k,I+V,"$"].join("|")+")",I+"?"+V+"+(?:['’](?:d|ll|m|re|s|t|ve))?",I+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d+",Z].join("|"),"g"),Y=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),F=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,H={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"},J="object"==typeof global&&global&&global.Object===Object&&global,W="object"==typeof self&&self&&self.Object===Object&&self,$=J||W||Function("return this")(),q=function(e){return function(r){return null==e?void 0:e[r]}}(H),B=Object.prototype.toString,Q=$.Symbol,X=Q?Q.prototype:void 0,ee=X?X.toString:void 0,re=function(e){return function(t){return r(x(b(t).replace(L,"")),e,"")}}(function(e,r,t){return r=r.toLowerCase(),e+(t?p(r):r)}),te=function(e){return function(r){var t=u(r=v(r))?i(r):void 0,n=t?t[0]:r.charAt(0),o=t?_(t,1).join(""):r.slice(1);return n[e]()+o}}("toUpperCase"),ne=e=>e.split("/").map(e=>re(e)).join("/"),ue={},oe={},ie=null,fe=[],ce=e=>{var{typeName:typeName}=e;if(se(typeName))return;"SourceProvider"===Object.getPrototypeOf(e).name&&(ue[typeName]=e)},se=e=>e in ue,ae=(e,r,t)=>{t=t||{};"string"!=typeof r&&(r=e);if(!se(e)||be(r))return null;var n=ue[e];oe[r]=new n(r,h({},n.settingsDefaults));fe.forEach(e=>{e(r)});return oe[r]},_e=e=>{if("function"!=typeof e)return;fe.push(e)},de=e=>{if(!be(e))return;var r=oe[e];r._disconnect();delete oe[e]},le=e=>oe[e],ve=()=>Object.keys(ue),pe=()=>Object.keys(oe),be=e=>e in oe,xe=e=>{m("defaultSourceProvider"),ie=e},ge=()=>ie;class ye{}var he={},me={},Oe={},je={},Pe=0,Se=()=>({__normalizedKey__:void 0,__fromProvider__:!1,__key__:void 0,__value__:void 0,__sources__:{}}),Ee=()=>({getterValues:{},setters:{},sources:{}}),ke=(e,r)=>{void 0===Oe[e]&&(Oe[e]={});void 0===Oe[e][r]&&(Oe[e][r]=new ye);return Oe[e][r]},Ae=(e,r,t)=>{var n=ke(e,r);Object.getOwnPropertyNames(n).forEach(e=>{if(e in t.__sources__)return;delete n[e]});for(var u in t.__sources__){(function(r){if(r in n)return"continue";var u=t.__sources__[r];Object.defineProperty(n,r,{configurable:!0,set(r){var t=me[e];if(void 0!==t){var n=t.setters[u.__key__];void 0!==n&&n(r)}},get(){if(void 0!==me[e])return me[e].getterValues[u.__key__]}})})(u)}},Ue=()=>{for(var e in je)(0,je[e])()},we=e=>e instanceof Object&&"Source"===e.constructor.name,Ne=(e,r,t)=>{if(0===t.length)return!1;var n=t[0];var u=r[n];if(void 0===u)return!1;t.length>1&&Ne(e,u.__sources__,t.slice(1));0!==Object.keys(u.__sources__).length||u.__fromProvider__||delete r[n];if(void 0===r[n])return delete me[e].sources[u.__key__],delete me[e].getterValues[u.__key__],delete me[e].setters[u.__key__],!0;var o=me[e];Ae(e,u.__key__,u);0===Object.keys(u.__sources__).length&&(o.getterValues[u.__key__]=u.__value__);return!0},Re=e=>he[e],ze=(e,r)=>{var t=Re(e);if(void 0===t)return null;if("string"!=typeof r)return t;var n=ne(r).split("/");var u=t.__sources__;for(var o in n){var i=n[o];if(n.length-1===parseInt(o))return i in u?u[i]:null;if(!(i in u))return null;u=u[i].__sources__}return null},Ie=e=>{if(e in me)return me[e].sources;return},Ve=(e,r)=>{var t=Ie(e);if(t)return t[r];return},De=e=>{if("function"!=typeof e)throw new Error("Callback is not a function");var r=Pe;Pe++;je[r]=e;var t=()=>{delete je[r]};return t},Te=e=>{var r=e in he;if(!r)return;for(var t in me[e].getterValues)!function(r){var t=me[e].getterValues[r];we(t)&&Object.getOwnPropertyNames(t).forEach(e=>{delete t[e]})}(t);he[e]=Se();me[e]=Ee();Ue()},Ze=(e,r)=>{if(void 0===he[e])return;var t=he[e];for(var n of r){var u=ne(n).split("/"),o=t.__sources__;for(var i in u){var f=u[i];if(!(f in o))break;u.length-1===parseInt(i)&&(o[f].__fromProvider__=!1,o[f].__value__=void 0),o=o[f].__sources__}Ne(e,t.__sources__,u)}},Ce=(e,r)=>{void 0===he[e]&&(he[e]=Se(),me[e]=Ee());var t=he[e];for(var n in r)!function(n){var u=r[n],o=n.split("/"),i=ne(n).split("/"),f=t.__sources__,c={};i.forEach((r,t)=>{var n=r in f;var s=o.slice(0,t+1).join("/");var a=me[e];n||(f[r]={__fromProvider__:!1,__normalizedKey__:i.slice(0,t+1).join("/"),__key__:s,__value__:void 0,__sources__:{}},a.getterValues[s]=ke(e,s),a.setters[s]=(()=>{}),Object.defineProperty(a.sources,s,{configurable:!0,set(r){var t=me[e];if(void 0!==t){var n=t.setters[s];void 0!==n&&n(r)}},get(){if(void 0!==me[e])return me[e].getterValues[s]}}));if(i.length-1===t){f[r].__fromProvider__=!0,f[r].__value__=u,0===Object.keys(f[r].__sources__).length&&(a.getterValues[s]=u);var _=le(e);a.setters[s]=(e=>{_.updateFromUser(s,e)})}0!==t&&(we(a.getterValues[c.__key__])||(a.getterValues[c.__key__]=ke(e,c.__key__)),Ae(e,c.__key__,c));c=f[r];f=f[r].__sources__})}(n);Ue()};class Le{static get typeName(){return null}static get settingsDefaults(){return{}}get settings(){return{}}constructor(e){if(new.target===Le)throw new TypeError("Cannot construct SourceProvider instances directly");this._providerName=e,this._sourceUpdates={},this._sourceRemovals=[],this._interval=setInterval(this._sendUpdates.bind(this),100)}updateSource(e,r){void 0===this._sourceUpdates[e]?this._sourceUpdates[e]={first:r}:this._sourceUpdates[e].last=r}removeSource(e){this._sourceRemovals.includes(e)||this._sourceRemovals.push(e)}subscribe(e,r,t){var n=De(()=>{r(this.getSource(e))});return t&&r(this.getSource(e)),n}getSource(e){return Ve(this._providerName,e)}getRawSource(e){return ze(this._providerName,e)}clearSources(){Te(this._providerName)}updateFromUser(e,r){}getType(e){return"string"==typeof e?"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":e instanceof Array?"Array":null===e?"null":null}_disconnect(){clearTimeout(this._interval)}_sendUpdates(){this._sendChanges(),this._sendRemovals()}_sendChanges(){if(0!==Object.keys(this._sourceUpdates).length){var e={},r={};for(var t in this._sourceUpdates){var n=this._sourceUpdates[t];e[t]=n.first,"last"in n&&(r[t]=n.last)}Ce(this._providerName,e),Object.keys(r).length>0&&setTimeout(()=>{Ce(this._providerName,r)}),this._sourceUpdates={}}}_sendRemovals(){this._sourceRemovals.length>0&&(Ze(this._providerName,this._sourceRemovals),this._sourceRemovals=[])}}var Ge=Le;e.SourceProvider=Ge,e.addSourceProvider=ae,e.addSourceProviderType=ce,e.getDefaultSourceProvider=ge,e.getSource=Ve,e.getSourceProvider=le,e.getSourceProviderNames=pe,e.getSourceProviderTypeNames=ve,e.getSources=Ie,e.hasSourceProvider=be,e.hasSourceProviderType=se,e.removeSourceProvider=de,e.setDefaultSourceProvider=xe,e.sourceProviderAdded=_e,Object.defineProperty(e,"__esModule",{value:!0})});
