!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.WebbitStore={}))}(this,function(e){"use strict";function t(e,t,r,n){var u=-1,o=e?e.length:0;for(n&&o&&(r=e[++u]);++u<o;)r=t(r,e[u],u,e);return r}function r(e){return e.split("")}function n(e){return e.match(j)||[]}function u(e){return M.test(e)}function o(e){return Y.test(e)}function i(e){return u(e)?f(e):r(e)}function f(e){return e.match(G)||[]}function c(e){return e.match(K)||[]}function s(e,t,r){var n=-1,u=e.length;t<0&&(t=-t>u?0:u+t),(r=r>u?u:r)<0&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(u);++n<u;)o[n]=e[n+t];return o}function a(e){if("string"==typeof e)return e;if(l(e))return X?X.call(e):"";var t=e+"";return"0"==t&&1/e==-m?"-0":t}function _(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:s(e,t,r)}function d(e){return!!e&&"object"==typeof e}function l(e){return"symbol"==typeof e||d(e)&&q.call(e)==O}function v(e){return null==e?"":a(e)}function p(e){return te(v(e).toLowerCase())}function b(e){return(e=v(e))&&e.replace(P,$).replace(L,"")}function x(e,t,r){return e=v(e),t=r?void 0:t,void 0===t?o(e)?c(e):n(e):e.match(t)||[]}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){g(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=1/0,O="[object Symbol]",j=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,P=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,S="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",E="["+S+"]",k="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",A="[a-z\\xdf-\\xf6\\xf8-\\xff]",U="[^\\ud800-\\udfff"+S+"\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",w="\\ud83c[\\udffb-\\udfff]",N="(?:\\ud83c[\\udde6-\\uddff]){2}",R="[\\ud800-\\udbff][\\udc00-\\udfff]",z="[A-Z\\xc0-\\xd6\\xd8-\\xde]",I="(?:"+A+"|"+U+")",V="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",D="[\\ufe0e\\ufe0f]?"+V+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",N,R].join("|")+")[\\ufe0e\\ufe0f]?"+V+")*"),T="(?:"+["[\\u2700-\\u27bf]",N,R].join("|")+")"+D,Z="(?:"+["[^\\ud800-\\udfff]"+k+"?",k,N,R,"[\\ud800-\\udfff]"].join("|")+")",C=RegExp("['’]","g"),L=RegExp(k,"g"),G=RegExp(w+"(?="+w+")|"+Z+D,"g"),K=RegExp([z+"?"+A+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[E,z,"$"].join("|")+")","(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[E,z+I,"$"].join("|")+")",z+"?"+I+"+(?:['’](?:d|ll|m|re|s|t|ve))?",z+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d+",T].join("|"),"g"),M=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Y=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,F={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"ss"},H="object"==typeof global&&global&&global.Object===Object&&global,J="object"==typeof self&&self&&self.Object===Object&&self,W=H||J||Function("return this")(),$=function(e){return function(t){return null==e?void 0:e[t]}}(F),q=Object.prototype.toString,B=W.Symbol,Q=B?B.prototype:void 0,X=Q?Q.toString:void 0,ee=function(e){return function(r){return t(x(b(r).replace(C,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?p(t):t)}),te=function(e){return function(t){var r=u(t=v(t))?i(t):void 0,n=r?r[0]:t.charAt(0),o=r?_(r,1).join(""):t.slice(1);return n[e]()+o}}("toUpperCase"),re=e=>e.split("/").map(e=>ee(e)).join("/"),ne={},ue={},oe=null,ie=[],fe=e=>{var{typeName:typeName}=e;if(ce(typeName))return;"SourceProvider"===Object.getPrototypeOf(e).name&&(ne[typeName]=e)},ce=e=>e in ne,se=(e,t,r)=>{r=r||{};"string"!=typeof t&&(t=e);if(!ce(e)||pe(t))return null;var n=ne[e];ue[t]=new n(t,h({},n.settingsDefaults));ie.forEach(e=>{e(t)});return ue[t]},ae=e=>{if("function"!=typeof e)return;ie.push(e)},_e=e=>{if(!pe(e))return;var t=ue[e];t._disconnect();delete ue[e]},de=e=>ue[e],le=()=>Object.keys(ne),ve=()=>Object.keys(ue),pe=e=>e in ue,be=e=>{oe=e},xe=()=>oe;class ge{}var ye={},he={},me={},Oe={},je=0,Pe=()=>({__normalizedKey__:void 0,__fromProvider__:!1,__key__:void 0,__value__:void 0,__sources__:{}}),Se=()=>({getterValues:{},setters:{},sources:{}}),Ee=(e,t)=>{void 0===me[e]&&(me[e]={});void 0===me[e][t]&&(me[e][t]=new ge);return me[e][t]},ke=(e,t,r)=>{var n=Ee(e,t);Object.getOwnPropertyNames(n).forEach(e=>{if(e in r.__sources__)return;delete n[e]});for(var u in r.__sources__){(function(t){if(t in n)return"continue";var u=r.__sources__[t];Object.defineProperty(n,t,{configurable:!0,set(t){var r=he[e];if(void 0!==r){var n=r.setters[u.__key__];void 0!==n&&n(t)}},get(){if(void 0!==he[e])return he[e].getterValues[u.__key__]}})})(u)}},Ae=()=>{for(var e in Oe)(0,Oe[e])()},Ue=e=>e instanceof Object&&"Source"===e.constructor.name,we=(e,t,r)=>{if(0===r.length)return!1;var n=r[0];var u=t[n];if(void 0===u)return!1;r.length>1&&we(e,u.__sources__,r.slice(1));0!==Object.keys(u.__sources__).length||u.__fromProvider__||delete t[n];if(void 0===t[n])return delete he[e].sources[u.__key__],delete he[e].getterValues[u.__key__],delete he[e].setters[u.__key__],!0;var o=he[e];ke(e,u.__key__,u);0===Object.keys(u.__sources__).length&&(o.getterValues[u.__key__]=u.__value__);return!0},Ne=e=>ye[e],Re=(e,t)=>{var r=Ne(e);if(void 0===r)return null;if("string"!=typeof t)return r;var n=re(t).split("/");var u=r.__sources__;for(var o in n){var i=n[o];if(n.length-1===parseInt(o))return i in u?u[i]:null;if(!(i in u))return null;u=u[i].__sources__}return null},ze=e=>{if(e in he)return he[e].sources;return},Ie=(e,t)=>{var r=ze(e);if(r)return r[t];return},Ve=e=>{if("function"!=typeof e)throw new Error("Callback is not a function");var t=je;je++;Oe[t]=e;var r=()=>{delete Oe[t]};return r},De=e=>{var t=e in ye;if(!t)return;for(var r in he[e].getterValues)!function(t){var r=he[e].getterValues[t];Ue(r)&&Object.getOwnPropertyNames(r).forEach(e=>{delete r[e]})}(r);ye[e]=Pe();he[e]=Se();Ae()},Te=(e,t)=>{if(void 0===ye[e])return;var r=ye[e];for(var n of t){var u=re(n).split("/"),o=r.__sources__;for(var i in u){var f=u[i];if(!(f in o))break;u.length-1===parseInt(i)&&(o[f].__fromProvider__=!1,o[f].__value__=void 0),o=o[f].__sources__}we(e,r.__sources__,u)}},Ze=(e,t)=>{void 0===ye[e]&&(ye[e]=Pe(),he[e]=Se());var r=ye[e];for(var n in t)!function(n){var u=t[n],o=n.split("/"),i=re(n).split("/"),f=r.__sources__,c={};i.forEach((t,r)=>{var n=t in f;var s=o.slice(0,r+1).join("/");var a=he[e];n||(f[t]={__fromProvider__:!1,__normalizedKey__:i.slice(0,r+1).join("/"),__key__:s,__value__:void 0,__sources__:{}},a.getterValues[s]=Ee(e,s),a.setters[s]=(()=>{}),Object.defineProperty(a.sources,s,{configurable:!0,set(t){var r=he[e];if(void 0!==r){var n=r.setters[s];void 0!==n&&n(t)}},get(){if(void 0!==he[e])return he[e].getterValues[s]}}));if(i.length-1===r){f[t].__fromProvider__=!0,f[t].__value__=u,0===Object.keys(f[t].__sources__).length&&(a.getterValues[s]=u);var _=de(e);a.setters[s]=(e=>{_.updateFromUser(s,e)})}0!==r&&(Ue(a.getterValues[c.__key__])||(a.getterValues[c.__key__]=Ee(e,c.__key__)),ke(e,c.__key__,c));c=f[t];f=f[t].__sources__})}(n);Ae()};class Ce{static get typeName(){return null}static get settingsDefaults(){return{}}get settings(){return{}}constructor(e){if(new.target===Ce)throw new TypeError("Cannot construct SourceProvider instances directly");this._providerName=e,this._sourceUpdates={},this._sourceRemovals=[],this._interval=setInterval(this._sendUpdates.bind(this),100)}updateSource(e,t){void 0===this._sourceUpdates[e]?this._sourceUpdates[e]={first:t}:this._sourceUpdates[e].last=t}removeSource(e){this._sourceRemovals.includes(e)||this._sourceRemovals.push(e)}subscribe(e,t,r){var n=Ve(()=>{t(this.getSource(e))});return r&&t(this.getSource(e)),n}getSource(e){return Ie(this._providerName,e)}getRawSource(e){return Re(this._providerName,e)}clearSources(){De(this._providerName)}updateFromUser(e,t){}getType(e){return"string"==typeof e?"string":"number"==typeof e?"number":"boolean"==typeof e?"boolean":e instanceof Array?"Array":null===e?"null":null}_disconnect(){clearTimeout(this._interval)}_sendUpdates(){this._sendChanges(),this._sendRemovals()}_sendChanges(){if(0!==Object.keys(this._sourceUpdates).length){var e={},t={};for(var r in this._sourceUpdates){var n=this._sourceUpdates[r];e[r]=n.first,"last"in n&&(t[r]=n.last)}Ze(this._providerName,e),Object.keys(t).length>0&&setTimeout(()=>{Ze(this._providerName,t)}),this._sourceUpdates={}}}_sendRemovals(){this._sourceRemovals.length>0&&(Te(this._providerName,this._sourceRemovals),this._sourceRemovals=[])}}var Le=Ce;e.SourceProvider=Le,e.addSourceProvider=se,e.addSourceProviderType=fe,e.getDefaultSourceProvider=xe,e.getSource=Ie,e.getSourceProvider=de,e.getSourceProviderNames=ve,e.getSourceProviderTypeNames=le,e.getSources=ze,e.hasSourceProvider=pe,e.hasSourceProviderType=ce,e.removeSourceProvider=_e,e.setDefaultSourceProvider=be,e.sourceProviderAdded=ae,Object.defineProperty(e,"__esModule",{value:!0})});
